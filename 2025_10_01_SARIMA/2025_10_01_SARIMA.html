<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="dcterms.date" content="2025-09-30">

<title>2025_09_24 ARIMA, lecture notes</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="2025_10_01_SARIMA_files/libs/clipboard/clipboard.min.js"></script>
<script src="2025_10_01_SARIMA_files/libs/quarto-html/quarto.js" type="module"></script>
<script src="2025_10_01_SARIMA_files/libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="2025_10_01_SARIMA_files/libs/quarto-html/popper.min.js"></script>
<script src="2025_10_01_SARIMA_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="2025_10_01_SARIMA_files/libs/quarto-html/anchor.min.js"></script>
<link href="2025_10_01_SARIMA_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="2025_10_01_SARIMA_files/libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="2025_10_01_SARIMA_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="2025_10_01_SARIMA_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="2025_10_01_SARIMA_files/libs/bootstrap/bootstrap-81267100e462c21b3d6c0d5bf76a3417.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="quarto-light">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#preliminaries" id="toc-preliminaries" class="nav-link active" data-scroll-target="#preliminaries">Preliminaries</a>
  <ul>
  <li><a href="#set-working-directory" id="toc-set-working-directory" class="nav-link" data-scroll-target="#set-working-directory">Set working directory</a></li>
  </ul></li>
  <li><a href="#car-registration-example" id="toc-car-registration-example" class="nav-link" data-scroll-target="#car-registration-example">Car Registration Example</a>
  <ul>
  <li><a href="#load-dataset" id="toc-load-dataset" class="nav-link" data-scroll-target="#load-dataset">Load dataset</a></li>
  <li><a href="#visualize-the-first-rows" id="toc-visualize-the-first-rows" class="nav-link" data-scroll-target="#visualize-the-first-rows">Visualize the first rows:</a></li>
  <li><a href="#convert-character-columns-to-r-date-type" id="toc-convert-character-columns-to-r-date-type" class="nav-link" data-scroll-target="#convert-character-columns-to-r-date-type">Convert character columns to R date type</a></li>
  <li><a href="#order-the-table-by-date-using-the-pipe-operator" id="toc-order-the-table-by-date-using-the-pipe-operator" class="nav-link" data-scroll-target="#order-the-table-by-date-using-the-pipe-operator">Order the table by date (using the pipe operator)</a></li>
  <li><a href="#check-for-missing-dates-time-gaps" id="toc-check-for-missing-dates-time-gaps" class="nav-link" data-scroll-target="#check-for-missing-dates-time-gaps">Check for missing dates (time gaps)</a></li>
  <li><a href="#check-for-missing-data-na-in-time-series-value-columns" id="toc-check-for-missing-data-na-in-time-series-value-columns" class="nav-link" data-scroll-target="#check-for-missing-data-na-in-time-series-value-columns">Check for missing data (NA) in time series value columns</a></li>
  <li><a href="#convert-it-to-a-time-series-object" id="toc-convert-it-to-a-time-series-object" class="nav-link" data-scroll-target="#convert-it-to-a-time-series-object">Convert it to a time series object</a></li>
  <li><a href="#time-plot" id="toc-time-plot" class="nav-link" data-scroll-target="#time-plot">Time plot:</a></li>
  <li><a href="#traintest-split" id="toc-traintest-split" class="nav-link" data-scroll-target="#traintest-split">Train/test split</a>
  <ul class="collapse">
  <li><a href="#what-if-i-dont-know-the-sampling-rate-of-the-time-series" id="toc-what-if-i-dont-know-the-sampling-rate-of-the-time-series" class="nav-link" data-scroll-target="#what-if-i-dont-know-the-sampling-rate-of-the-time-series">What if I don’t know the sampling rate of the time series?</a></li>
  </ul></li>
  <li><a href="#identification-and-fitting-process" id="toc-identification-and-fitting-process" class="nav-link" data-scroll-target="#identification-and-fitting-process">Identification and fitting process</a>
  <ul class="collapse">
  <li><a href="#box-cox-transformation" id="toc-box-cox-transformation" class="nav-link" data-scroll-target="#box-cox-transformation">Box-Cox transformation</a></li>
  <li><a href="#differencing" id="toc-differencing" class="nav-link" data-scroll-target="#differencing">Differencing</a>
  <ul class="collapse">
  <li><a href="#seasonal-differencing" id="toc-seasonal-differencing" class="nav-link" data-scroll-target="#seasonal-differencing">Seasonal Differencing</a></li>
  <li><a href="#regular-differencing-without-seasonal" id="toc-regular-differencing-without-seasonal" class="nav-link" data-scroll-target="#regular-differencing-without-seasonal">Regular Differencing (without seasonal)</a></li>
  <li><a href="#both-regular-seasonal-differentiation" id="toc-both-regular-seasonal-differentiation" class="nav-link" data-scroll-target="#both-regular-seasonal-differentiation">Both regular &amp; seasonal Differentiation</a></li>
  <li><a href="#model-order-p-d-qp-d-q_s-selection" id="toc-model-order-p-d-qp-d-q_s-selection" class="nav-link" data-scroll-target="#model-order-p-d-qp-d-q_s-selection">Model Order (p, d, q)(P, D, Q)_s selection</a></li>
  </ul></li>
  <li><a href="#fit-seasonal-model-with-estimated-order" id="toc-fit-seasonal-model-with-estimated-order" class="nav-link" data-scroll-target="#fit-seasonal-model-with-estimated-order">Fit seasonal model with estimated order</a></li>
  </ul></li>
  <li><a href="#model-diagnosis" id="toc-model-diagnosis" class="nav-link" data-scroll-target="#model-diagnosis">Model Diagnosis</a>
  <ul class="collapse">
  <li><a href="#summary-of-training-errors-and-estimated-coefficients" id="toc-summary-of-training-errors-and-estimated-coefficients" class="nav-link" data-scroll-target="#summary-of-training-errors-and-estimated-coefficients">Summary of training errors and estimated coefficients</a></li>
  <li><a href="#statistical-significance-of-estimated-coefficients" id="toc-statistical-significance-of-estimated-coefficients" class="nav-link" data-scroll-target="#statistical-significance-of-estimated-coefficients">Statistical significance of estimated coefficients</a></li>
  <li><a href="#root-plot" id="toc-root-plot" class="nav-link" data-scroll-target="#root-plot">Root plot</a></li>
  <li><a href="#check-residuals" id="toc-check-residuals" class="nav-link" data-scroll-target="#check-residuals">Check residuals</a></li>
  <li><a href="#check-the-fitted-values" id="toc-check-the-fitted-values" class="nav-link" data-scroll-target="#check-the-fitted-values">Check the fitted values</a></li>
  </ul></li>
  <li><a href="#future-forecast-and-validation" id="toc-future-forecast-and-validation" class="nav-link" data-scroll-target="#future-forecast-and-validation">Future forecast and validation</a>
  <ul class="collapse">
  <li><a href="#validation-error-for-h-1" id="toc-validation-error-for-h-1" class="nav-link" data-scroll-target="#validation-error-for-h-1">Validation error for h = 1</a></li>
  </ul></li>
  <li><a href="#additional-code" id="toc-additional-code" class="nav-link" data-scroll-target="#additional-code">Additional Code</a></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references">References</a></li>
  </ul></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">2025_09_24 ARIMA, lecture notes</h1>
</div>



<div class="quarto-title-meta">

    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">September 30, 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="preliminaries" class="level1">
<h1>Preliminaries</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="do">########################################################################################</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="do">##############       Forecasting:      SARIMA models        ############################</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="do">########################################################################################</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(MLTools)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(fpp2)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readxl)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(TSstudio)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lmtest)  <span class="co">#contains coeftest function</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tseries) <span class="co">#contains adf.test function</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="set-working-directory" class="level3">
<h3 class="anchored" data-anchor-id="set-working-directory">Set working directory</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(<span class="fu">dirname</span>(rstudioapi<span class="sc">::</span><span class="fu">getActiveDocumentContext</span>()<span class="sc">$</span>path))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="car-registration-example" class="level1">
<h1>Car Registration Example</h1>
<!-- ![Fig. 9.12 in FPP3: @hyndman2021fpp3](https://otexts.com/fpp3/figs/arimaflowchart.png) -->
<section id="load-dataset" class="level4">
<h4 class="anchored" data-anchor-id="load-dataset">Load dataset</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>fdata <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="st">"CarRegistrations.xls"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="visualize-the-first-rows" class="level4">
<h4 class="anchored" data-anchor-id="visualize-the-first-rows">Visualize the first rows:</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(fdata)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 2
  Fecha               CarReg
  &lt;dttm&gt;               &lt;dbl&gt;
1 1960-01-01 00:00:00   3.36
2 1960-02-01 00:00:00   4.38
3 1960-03-01 00:00:00   4.06
4 1960-04-01 00:00:00   5.38
5 1960-05-01 00:00:00   6.31
6 1960-06-01 00:00:00   4.02</code></pre>
</div>
</div>
</section>
<section id="convert-character-columns-to-r-date-type" class="level4">
<h4 class="anchored" data-anchor-id="convert-character-columns-to-r-date-type">Convert character columns to R date type</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>fdata<span class="sc">$</span>Fecha <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(fdata<span class="sc">$</span>Fecha, <span class="at">format =</span> <span class="st">"%d/%m/%Y"</span>)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(fdata)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 2
  Fecha      CarReg
  &lt;date&gt;      &lt;dbl&gt;
1 1960-01-01   3.36
2 1960-02-01   4.38
3 1960-03-01   4.06
4 1960-04-01   5.38
5 1960-05-01   6.31
6 1960-06-01   4.02</code></pre>
</div>
</div>
</section>
<section id="order-the-table-by-date-using-the-pipe-operator" class="level4">
<h4 class="anchored" data-anchor-id="order-the-table-by-date-using-the-pipe-operator">Order the table by date (using the pipe operator)</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>fdata <span class="ot">&lt;-</span> fdata <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(Fecha)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This is the same as: <code>fdata &lt;- arrange(fdata, Fecha)</code></p>
</section>
<section id="check-for-missing-dates-time-gaps" class="level4">
<h4 class="anchored" data-anchor-id="check-for-missing-dates-time-gaps">Check for missing dates (time gaps)</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">range</span>(fdata<span class="sc">$</span>Fecha)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "1960-01-01" "1999-12-01"</code></pre>
</div>
</div>
<p>Create a complete sequence of months with the same range and compare it to the dates in our data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>date_range <span class="ot">&lt;-</span> <span class="fu">seq.Date</span>(<span class="fu">min</span>(fdata<span class="sc">$</span>Fecha), <span class="fu">max</span>(fdata<span class="sc">$</span>Fecha), <span class="at">by =</span> <span class="st">"months"</span>)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>date_range[<span class="sc">!</span>date_range <span class="sc">%in%</span> fdata<span class="sc">$</span>Fecha]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Date of length 0</code></pre>
</div>
</div>
<p>We also check for duplicates</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>fdata <span class="sc">%&gt;%</span> </span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Fecha) <span class="sc">%&gt;%</span> </span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">duplicated</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">which</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>integer(0)</code></pre>
</div>
</div>
</section>
<section id="check-for-missing-data-na-in-time-series-value-columns" class="level4">
<h4 class="anchored" data-anchor-id="check-for-missing-data-na-in-time-series-value-columns">Check for missing data (NA) in time series value columns</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="fu">is.na</span>(fdata<span class="sc">$</span>CarReg))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0</code></pre>
</div>
</div>
</section>
<section id="convert-it-to-a-time-series-object" class="level4">
<h4 class="anchored" data-anchor-id="convert-it-to-a-time-series-object">Convert it to a time series object</h4>
<p>This is monthly data, so the frequency is 12. The series start in January. If it starts in e.g.&nbsp;April we would use start = c(1960, 4)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>freq <span class="ot">&lt;-</span> <span class="dv">12</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>start_date  <span class="ot">&lt;-</span>  <span class="fu">c</span>(<span class="dv">1960</span>, <span class="dv">1</span>)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">ts</span>(fdata<span class="sc">$</span>CarReg, <span class="at">start =</span> start_date, <span class="at">frequency =</span> freq)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="time-plot" class="level4">
<h4 class="anchored" data-anchor-id="time-plot">Time plot:</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(y) <span class="sc">+</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Car registrations"</span>) <span class="sc">+</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Year"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Number registered (thousands)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="2025_10_01_SARIMA_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid figure-img" width="1152"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="traintest-split" class="level2">
<h2 class="anchored" data-anchor-id="traintest-split">Train/test split</h2>
<p>The train/test split method in forecasting needs to take the temporal structure into account, as illustrated in this picture (from Section 3.4 of <span class="citation" data-cites="hyndman2018fpp2">Hyndman &amp; Athanasopoulos (<a href="#ref-hyndman2018fpp2" role="doc-biblioref">2018</a>)</span>)</p>
<p><img src="https://otexts.com/fpp2/fpp_files/figure-html/traintest-1.png" class="img-fluid" width="800"></p>
<pre><code>n &lt;- length(y)</code></pre>
<p>We will leave the last 5 years for validation</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>n_test <span class="ot">&lt;-</span> <span class="fu">floor</span>(<span class="dv">5</span> <span class="sc">*</span> freq)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>y_split <span class="ot">&lt;-</span> <span class="fu">ts_split</span>(y, <span class="at">sample.out =</span> n_test)</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>y.TR <span class="ot">&lt;-</span> y_split<span class="sc">$</span>train</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>y.TV <span class="ot">&lt;-</span> y_split<span class="sc">$</span>test</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Alternatively, with <code>subset</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Line 39 of Lab4</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>y.TR <span class="ot">&lt;-</span> <span class="fu">subset</span>(y, <span class="at">end =</span> <span class="fu">length</span>(y) <span class="sc">-</span> <span class="dv">5</span> <span class="sc">*</span> <span class="dv">12</span>) </span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>y.TV <span class="ot">&lt;-</span> <span class="fu">subset</span>(y, <span class="at">start =</span> <span class="fu">length</span>(y) <span class="sc">-</span> <span class="dv">5</span> <span class="sc">*</span> <span class="dv">12</span> <span class="sc">+</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Or even with <code>head</code> and <code>tail</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>y.TR <span class="ot">&lt;-</span> <span class="fu">head</span>(y, <span class="fu">length</span>(y) <span class="sc">-</span> <span class="dv">5</span> <span class="sc">*</span> <span class="dv">12</span>) </span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>y.TV <span class="ot">&lt;-</span> <span class="fu">tail</span>(y, <span class="dv">5</span> <span class="sc">*</span> <span class="dv">12</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In fact it is usually a good idea to check the split using <code>head</code> and <code>tail</code> to see the last elements of training and the first ones of <code>test</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tail</span>(y.TR)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         Jul     Aug     Sep     Oct     Nov     Dec
1994 104.812  65.899  65.201  71.931  68.761  93.883</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(y.TV)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         Jan     Feb     Mar     Apr     May     Jun
1995  54.513  66.954  95.812  74.758  82.887 104.472</code></pre>
</div>
</div>
<p>And let us also visualize the split.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(y.TR, <span class="at">color =</span> <span class="st">"orange"</span>) <span class="sc">+</span> </span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autolayer</span>(y.TV, <span class="at">color =</span> <span class="st">"blue"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="2025_10_01_SARIMA_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid figure-img" width="1152"></p>
</figure>
</div>
</div>
</div>
<section id="what-if-i-dont-know-the-sampling-rate-of-the-time-series" class="level3">
<h3 class="anchored" data-anchor-id="what-if-i-dont-know-the-sampling-rate-of-the-time-series">What if I don’t know the sampling rate of the time series?</h3>
<p>Donwload the following data file: <a href="https://gist.githubusercontent.com/fsansegundo/61b9cd0e5a7fc8d7c404823bd261b1f6/raw/578dcb42f7c2b34d5467ad6562daf1dc18ad8e82/fdata2.dat">fdata2.dat</a></p>
<p>Let us use plots to explore the series</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>fdata2 <span class="ot">&lt;-</span> <span class="fu">ts</span>(<span class="fu">read.table</span>(<span class="st">"fdata2.dat"</span>, <span class="at">sep =</span> <span class="st">""</span>))</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggtsdisplay</span>(fdata2, <span class="at">lag.max =</span> <span class="dv">80</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="2025_10_01_SARIMA_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The time plot does not clearly show the frequency (in cases like this you should try <em>zooming in</em>, though!). But the ACF is more telling, it shows significant correlations at what seems to be lags = 24, 48, 96, … (so the sampling rate of this data seems to be … daily, weekly, … ?)</p>
<p>Let us try that and emphasize the lags we suspect to be relevant:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>freq <span class="ot">&lt;-</span> <span class="dv">24</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggAcf</span>(fdata2, <span class="at">lag.max =</span> <span class="dv">80</span>)<span class="sc">+</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> (<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>) <span class="sc">*</span> freq, <span class="at">color =</span> <span class="st">"green"</span>, <span class="at">alpha =</span> <span class="fl">0.25</span>, <span class="at">size=</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.
ℹ Please use `linewidth` instead.</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="2025_10_01_SARIMA_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Applying a seasonal difference</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggtsdisplay</span>(<span class="fu">diff</span>(fdata2, <span class="at">lag =</span> freq), <span class="at">lag.max =</span> <span class="dv">5</span> <span class="sc">*</span> freq)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="2025_10_01_SARIMA_files/figure-html/unnamed-chunk-21-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="identification-and-fitting-process" class="level2">
<h2 class="anchored" data-anchor-id="identification-and-fitting-process">Identification and fitting process</h2>
<p>Let us return to the Car Registration example</p>
<section id="box-cox-transformation" class="level3">
<h3 class="anchored" data-anchor-id="box-cox-transformation">Box-Cox transformation</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Line 48 of Lab4</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>Lambda <span class="ot">&lt;-</span> <span class="fu">BoxCox.lambda.plot</span>(y.TR, <span class="at">window.width =</span> <span class="dv">12</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="2025_10_01_SARIMA_files/figure-html/unnamed-chunk-22-1.png" class="img-fluid figure-img" width="1152"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Line 51 of Lab4</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>z <span class="ot">&lt;-</span> <span class="fu">BoxCox</span>(y.TR, Lambda)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Line 39 of Lab4</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">autoplot</span>(z)</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">autoplot</span>(y)</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>gridExtra<span class="sc">::</span><span class="fu">grid.arrange</span>(p1, p2, <span class="at">nrow =</span> <span class="dv">2</span> )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="2025_10_01_SARIMA_files/figure-html/unnamed-chunk-24-1.png" class="img-fluid figure-img" width="1152"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="differencing" class="level3">
<h3 class="anchored" data-anchor-id="differencing">Differencing</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Line 58 of Lab4</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="co">#recall if the ACF decreases very slowly -&gt; needs differentiation</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggtsdisplay</span>(z,<span class="at">lag.max =</span> <span class="dv">100</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="2025_10_01_SARIMA_files/figure-html/unnamed-chunk-26-1.png" class="img-fluid figure-img" width="1152"></p>
</figure>
</div>
</div>
</div>
<section id="seasonal-differencing" class="level4">
<h4 class="anchored" data-anchor-id="seasonal-differencing">Seasonal Differencing</h4>
<p>It is generally better to start with seasonal differencing when a time series exhibits both seasonal and non-seasonal patterns.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Line 62 of Lab4</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>B12z<span class="ot">&lt;-</span> <span class="fu">diff</span>(z, <span class="at">lag =</span> freq, <span class="at">differences =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We use the ACF and PACF to inspect the result</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggtsdisplay</span>(B12z,<span class="at">lag.max =</span> <span class="dv">4</span> <span class="sc">*</span> freq)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="2025_10_01_SARIMA_files/figure-html/unnamed-chunk-28-1.png" class="img-fluid figure-img" width="1152"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="regular-differencing-without-seasonal" class="level4">
<h4 class="anchored" data-anchor-id="regular-differencing-without-seasonal">Regular Differencing (without seasonal)</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Line 66 of Lab4</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>Bz <span class="ot">&lt;-</span> <span class="fu">diff</span>(z,<span class="at">differences =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggtsdisplay</span>(Bz, <span class="at">lag.max =</span> <span class="dv">4</span> <span class="sc">*</span> freq)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="2025_10_01_SARIMA_files/figure-html/unnamed-chunk-30-1.png" class="img-fluid figure-img" width="1152"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="both-regular-seasonal-differentiation" class="level4">
<h4 class="anchored" data-anchor-id="both-regular-seasonal-differentiation">Both regular &amp; seasonal Differentiation</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Line 70 of Lab4</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>B12Bz <span class="ot">&lt;-</span> <span class="fu">diff</span>(Bz, <span class="at">lag =</span> freq, <span class="at">differences =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggtsdisplay</span>(B12Bz, <span class="at">lag.max =</span> <span class="dv">4</span> <span class="sc">*</span> freq)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="2025_10_01_SARIMA_files/figure-html/unnamed-chunk-32-1.png" class="img-fluid figure-img" width="1152"></p>
</figure>
</div>
</div>
</div>
<p>Remember, when you apply both differences the order does not matter. Here we check that visually:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>B_B12z<span class="ot">&lt;-</span> <span class="fu">diff</span>(B12z, <span class="at">differences =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Line 75 of Lab4</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(B12Bz, <span class="at">color =</span> <span class="st">"blue"</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span> <span class="fu">autolayer</span>(B_B12z, <span class="at">color =</span> <span class="st">"orange"</span>, <span class="at">size =</span> <span class="fl">0.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="2025_10_01_SARIMA_files/figure-html/unnamed-chunk-34-1.png" class="img-fluid figure-img" width="1152"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="model-order-p-d-qp-d-q_s-selection" class="level4">
<h4 class="anchored" data-anchor-id="model-order-p-d-qp-d-q_s-selection">Model Order (p, d, q)(P, D, Q)_s selection</h4>
<p>Now, using the results above, we select both the regular d and the seasonal D orders of differencing and the ARMA structure, both regular and seasonal</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>q <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>P <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>D <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>Q <span class="ot">&lt;-</span> <span class="dv">1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="fit-seasonal-model-with-estimated-order" class="level3">
<h3 class="anchored" data-anchor-id="fit-seasonal-model-with-estimated-order">Fit seasonal model with estimated order</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Line 80 (modified) of Lab4</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>arima.fit <span class="ot">&lt;-</span> <span class="fu">Arima</span>(y.TR,</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">order=</span><span class="fu">c</span>(p, d, q),</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">seasonal =</span> <span class="fu">list</span>(<span class="at">order=</span><span class="fu">c</span>(P, D, Q), <span class="at">period=</span>freq),</span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>                   <span class="at">lambda =</span> Lambda,</span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>                   <span class="at">include.constant =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="model-diagnosis" class="level2">
<h2 class="anchored" data-anchor-id="model-diagnosis">Model Diagnosis</h2>
<section id="summary-of-training-errors-and-estimated-coefficients" class="level4">
<h4 class="anchored" data-anchor-id="summary-of-training-errors-and-estimated-coefficients">Summary of training errors and estimated coefficients</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Line 86 of Lab4</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(arima.fit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Series: y.TR 
ARIMA(0,1,1)(1,1,1)[24] 
Box Cox transformation: lambda= -0.02149828 

Coefficients:
          ma1    sar1     sma1
      -0.5997  0.0877  -0.8988
s.e.   0.0432  0.0670   0.0655

sigma^2 = 0.01475:  log likelihood = 255.92
AIC=-503.83   AICc=-503.73   BIC=-487.92

Training set error measures:
                    ME     RMSE      MAE       MPE     MAPE      MASE
Training set -0.432281 6.160028 4.327191 -2.242973 9.844774 0.6289316
                    ACF1
Training set -0.03946431</code></pre>
</div>
</div>
</section>
<section id="statistical-significance-of-estimated-coefficients" class="level4">
<h4 class="anchored" data-anchor-id="statistical-significance-of-estimated-coefficients">Statistical significance of estimated coefficients</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Line 87 of Lab4</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a><span class="fu">coeftest</span>(arima.fit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
z test of coefficients:

      Estimate Std. Error  z value Pr(&gt;|z|)    
ma1  -0.599729   0.043169 -13.8927   &lt;2e-16 ***
sar1  0.087686   0.066970   1.3093   0.1904    
sma1 -0.898751   0.065466 -13.7285   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
</section>
<section id="root-plot" class="level4">
<h4 class="anchored" data-anchor-id="root-plot">Root plot</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Line 88 of Lab4</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(arima.fit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="2025_10_01_SARIMA_files/figure-html/unnamed-chunk-39-1.png" class="img-fluid figure-img" width="1152"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="check-residuals" class="level4">
<h4 class="anchored" data-anchor-id="check-residuals">Check residuals</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Line 91 of Lab4</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a><span class="fu">CheckResiduals.ICAI</span>(arima.fit, <span class="at">bins =</span> <span class="dv">100</span>, <span class="at">lag=</span><span class="dv">100</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="2025_10_01_SARIMA_files/figure-html/unnamed-chunk-40-1.png" class="img-fluid figure-img" width="1152"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Ljung-Box test

data:  Residuals from ARIMA(0,1,1)(1,1,1)[24]
Q* = 89.452, df = 97, p-value = 0.6944

Model df: 3.   Total lags used: 100</code></pre>
</div>
</div>
<p>If residuals are not white noise, change order of ARMA</p>
</section>
<section id="check-the-fitted-values" class="level4">
<h4 class="anchored" data-anchor-id="check-the-fitted-values">Check the fitted values</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Line 94 of Lab4</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(y.TR, <span class="at">series =</span> <span class="st">"Real"</span>) <span class="sc">+</span></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>  forecast<span class="sc">::</span><span class="fu">autolayer</span>(arima.fit<span class="sc">$</span>fitted, <span class="at">series =</span> <span class="st">"Fitted"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="2025_10_01_SARIMA_files/figure-html/unnamed-chunk-41-1.png" class="img-fluid figure-img" width="1152"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="future-forecast-and-validation" class="level2">
<h2 class="anchored" data-anchor-id="future-forecast-and-validation">Future forecast and validation</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Line 99 of Lab4</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>y_est <span class="ot">&lt;-</span> forecast<span class="sc">::</span><span class="fu">forecast</span>(y.TR, <span class="at">model=</span>arima.fit, <span class="at">h=</span>freq)</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(y_est<span class="sc">$</span>mean, <span class="at">n =</span> <span class="dv">12</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>           Jan       Feb       Mar       Apr       May       Jun       Jul
1995  72.24402  77.72355  92.74988  87.79493  89.38275  91.23070 104.15455
           Aug       Sep       Oct       Nov       Dec
1995  64.00357  66.17088  84.55637  82.06407  85.81810</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>xmin <span class="ot">&lt;-</span> <span class="dv">1995</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>xmax <span class="ot">&lt;-</span> <span class="dv">1996</span></span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>ymin <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>ymax <span class="ot">&lt;-</span> <span class="cn">Inf</span></span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(<span class="fu">subset</span>(y, <span class="at">start=</span><span class="fu">length</span>(y.TR) <span class="sc">-</span> <span class="dv">30</span>, <span class="at">end=</span><span class="fu">length</span>(y.TR) <span class="sc">+</span> freq)) <span class="sc">+</span> </span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autolayer</span>(y_est, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb58-8"><a href="#cb58-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"rect"</span>, <span class="at">xmin=</span>xmin, <span class="at">xmax=</span>xmax, <span class="at">ymin=</span>ymin, <span class="at">ymax=</span> ymax, <span class="at">alpha=</span><span class="fl">0.2</span>, <span class="at">fill=</span><span class="st">"orange"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="2025_10_01_SARIMA_files/figure-html/unnamed-chunk-43-1.png" class="img-fluid figure-img" width="1152"></p>
</figure>
</div>
</div>
</div>
<section id="validation-error-for-h-1" class="level3">
<h3 class="anchored" data-anchor-id="validation-error-for-h-1">Validation error for h = 1</h3>
<p>Obtain the forecast in validation for horizon = 1 using the trained parameters of the model. We loop through the validation period, adding one point of the time series each time and forecasting the next value (h = 1).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Line 104 of Lab4</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>y.TV.est <span class="ot">&lt;-</span> y <span class="sc">*</span> <span class="cn">NA</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Line 106  of Lab4</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq</span>(<span class="fu">length</span>(y.TR) <span class="sc">+</span> <span class="dv">1</span>, <span class="fu">length</span>(y), <span class="dv">1</span>)){</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>  y.TV.est[i] <span class="ot">&lt;-</span> forecast<span class="sc">::</span><span class="fu">forecast</span>(<span class="fu">subset</span>(y, <span class="at">end=</span>i<span class="dv">-1</span>), </span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>                          <span class="at">model =</span> arima.fit,       </span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a>                          <span class="at">h=</span><span class="dv">1</span>)<span class="sc">$</span>mean                </span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Next we plot the series and both forecasts. We limit the values depicted in the plot to improve the visualization. As you can see the loop forecasts (with h = 1) appear to be better than the h=12 forecasts in y_est.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Line 116 of Lab4</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(<span class="fu">subset</span>(y, <span class="at">start=</span><span class="fu">length</span>(y.TR) <span class="sc">-</span> <span class="dv">24</span>, <span class="at">end =</span> <span class="fu">length</span>(y.TR) <span class="sc">+</span> <span class="dv">12</span>)) <span class="sc">+</span></span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>  forecast<span class="sc">::</span><span class="fu">autolayer</span>(y_est<span class="sc">$</span>mean, <span class="at">color=</span><span class="st">"blue"</span>) <span class="sc">+</span> </span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>  forecast<span class="sc">::</span><span class="fu">autolayer</span>(<span class="fu">subset</span>(y.TV.est, <span class="at">start =</span> <span class="fu">length</span>(y.TR) <span class="sc">+</span> <span class="dv">1</span>, </span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a>                             <span class="at">end =</span> <span class="fu">length</span>(y.TR) <span class="sc">+</span> <span class="dv">12</span>), <span class="at">color=</span><span class="st">"red"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="2025_10_01_SARIMA_files/figure-html/unnamed-chunk-46-1.png" class="img-fluid figure-img" width="1152"></p>
</figure>
</div>
</div>
</div>
<p>Finally we compute the validation errors</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Line 120 of Lab4</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a><span class="fu">accuracy</span>(<span class="fu">subset</span>(y.TV.est, <span class="at">start =</span> <span class="fu">length</span>(y.TR) <span class="sc">+</span> <span class="dv">1</span>), y)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>               ME     RMSE     MAE        MPE     MAPE      ACF1 Theil's U
Test set 1.643639 10.10724 7.91742 0.04251236 8.459256 -0.238131  0.425696</code></pre>
</div>
</div>
<p>Uncomment the following line to see the direct computation of RSME</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sqrt</span>(<span class="fu">mean</span>((y.TV.est <span class="sc">-</span> y.TV)<span class="sc">^</span><span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 10.10724</code></pre>
</div>
</div>
</section>
</section>
<section id="additional-code" class="level2">
<h2 class="anchored" data-anchor-id="additional-code">Additional Code</h2>
<p>We have seen above that the result of using forecast is different from the result of the validation loop. Both are using the fitted model to forecast, so what is the difference?</p>
<p>Below we will explicitly use the fitted model coefficients to obtain the forecasted values, both for the validation loop and for the <code>forecast</code> function. Keep in mind that the Arima function incorporates the BoxCox transformation. So to make things simpler, we will work directly with z instead of y.</p>
<p>Recall that the equation of our model is: <span class="math display">\[
(1 - \Phi_1B^{12})(1 - B)(1 - B^{12})z_t =
(1 - \theta_1 B)(1 - \Theta_1 B^{12})\epsilon_t
\]</span> But we can expand this equation and reorganize it into a forecasting equation: <span class="math display">\[
z_t = z_t = z_{t-1} + z_{t-12} - z_{t-13} +
\Phi_1 (z_{t-12} - z_{t-13} - z_{t-24} + z_{t-25}) + \\
\epsilon_t + \theta_1 \epsilon_{t-1} + \Theta_1 \epsilon_{t-12} +
\theta_1 \Theta_1 \epsilon_{t-13}
\]</span> Similarly we can do the same with the error term to get <span class="math display">\[
\epsilon_t = z_t - z_{t-1} - z_{t-12} + z_{t-13} -
\phi_1 (z_{t-12} - z_{t-13} - z_{t-24} + z_{t-25}) - \\
\theta_1 \epsilon_{t-1} - \Theta_1 \epsilon_{t-12} - \theta_1 \Theta_1 \epsilon_{t-13}
\]</span> The right hand side of these equation only contains lags of <span class="math inline">\(z_t\)</span> and <span class="math inline">\(\epsilon_t\)</span>. <a href="https://otexts.com/fpp3/arima-forecasting.html#arima-forecasting">Section 9.8 of <span class="citation" data-cites="hyndman2021fpp3">Hyndman &amp; Athanasopoulos (<span>2021</span>)</span></a> explains how to apply this forecasting equations. In summary: when you start forecasting the first values you replace past values of <span class="math inline">\(z\)</span> with training set values and <span class="math inline">\(\epsilon\)</span> values with the residuals of the fitted model (also corresponding to training). As you move further into the test set, unknown values of <span class="math inline">\(z\)</span> and <span class="math inline">\(\epsilon\)</span> will be needed. The difference between <code>forecast</code> and the validation loop is in deciding what values we use for <span class="math inline">\(z\)</span> and <span class="math inline">\(\epsilon\)</span> for <span class="math inline">\(t\)</span> values corresponding to the test set. Let us explore this in the code.</p>
<p>So we begin by splitting z into training and test. <strong>Technical note:</strong> Lambda was determined using only the training set, and we apply the same Lambda to the test set to prevent data leakage.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>z <span class="ot">&lt;-</span> <span class="fu">BoxCox</span>(y, Lambda)</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>z.TR <span class="ot">&lt;-</span> <span class="fu">subset</span>(z, <span class="at">end =</span> <span class="fu">length</span>(y.TR))</span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>z.TV <span class="ot">&lt;-</span> <span class="fu">subset</span>(z, <span class="at">start =</span> <span class="fu">length</span>(y.TR) <span class="sc">+</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We fit a seasonal model to z with the same order we used for y, but setting lambda equal to 1.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>arima.fit <span class="ot">&lt;-</span> <span class="fu">Arima</span>(z.TR, </span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>                   <span class="at">order=</span><span class="fu">c</span>(p, d, q),</span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">seasonal =</span> <span class="fu">list</span>(<span class="at">order=</span><span class="fu">c</span>(P, D, Q), <span class="at">period=</span><span class="dv">12</span>),</span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">lambda =</span> <span class="dv">1</span>, </span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a>                   <span class="at">include.constant =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In the code below you can verify that the model fit is equivalent to what we obtained above for y.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(arima.fit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Series: z.TR 
ARIMA(0,1,1)(1,1,1)[12] 
Box Cox transformation: lambda= 1 

Coefficients:
          ma1    sar1     sma1
      -0.5936  0.2317  -0.9189
s.e.   0.0435  0.0611   0.0394

sigma^2 = 0.01329:  log likelihood = 294.41
AIC=-580.82   AICc=-580.72   BIC=-564.78

Training set error measures:
                       ME      RMSE        MAE        MPE     MAPE      MASE
Training set -0.008851714 0.1130747 0.08373548 -0.3647752 2.684318 0.5294322
                   ACF1
Training set 0.02378263</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="fu">coeftest</span>(arima.fit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
z test of coefficients:

      Estimate Std. Error  z value  Pr(&gt;|z|)    
ma1  -0.593623   0.043517 -13.6413 &lt; 2.2e-16 ***
sar1  0.231663   0.061055   3.7943  0.000148 ***
sma1 -0.918918   0.039365 -23.3437 &lt; 2.2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(arima.fit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="2025_10_01_SARIMA_files/figure-html/unnamed-chunk-53-1.png" class="img-fluid figure-img" width="1152"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="fu">CheckResiduals.ICAI</span>(arima.fit, <span class="at">bins =</span> <span class="dv">100</span>, <span class="at">lag=</span><span class="dv">100</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="2025_10_01_SARIMA_files/figure-html/unnamed-chunk-54-1.png" class="img-fluid figure-img" width="1152"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Ljung-Box test

data:  Residuals from ARIMA(0,1,1)(1,1,1)[12]
Q* = 80.576, df = 97, p-value = 0.8858

Model df: 3.   Total lags used: 100</code></pre>
</div>
</div>
<p>Now let us begin using this model to forecast the test set values.</p>
<p>We begin by using the <code>forecast</code> function to forecast <strong>all the values</strong> in the test set. That is, we set the forecasting horizon h equal to the length of the test set,</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>z_est <span class="ot">&lt;-</span> forecast<span class="sc">::</span><span class="fu">forecast</span>(arima.fit, <span class="at">h=</span><span class="fu">length</span>(z.TV))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Next we will generate three additional versions of the forecasts, using a loop as we did before.</p>
<ul>
<li>The first forecast <code>z.TV.est</code> is exactly what we did before, but using z instead of y.</li>
<li>The second one <code>z.TV.est2</code> will use the two forecasting equations (with the fitted coefficients) and will always use <strong>actual values</strong> of <span class="math inline">\(z_t\)</span> in the test set. The error terms will also be updated with the second forecasting equation.</li>
<li>The third one <code>z.TV.est3</code> will also use the forecasting equation, but it will use its own <strong>forecasted values</strong> of <span class="math inline">\(z_t\)</span> in the test set. The error terms for <span class="math inline">\(t\)</span> in the test set will all be set to zero.</li>
</ul>
<p>First we create empty time series to store the different forecasts.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>z.TV.est <span class="ot">&lt;-</span> z <span class="sc">*</span> <span class="cn">NA</span></span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>z.TV.est2 <span class="ot">&lt;-</span> z <span class="sc">*</span> <span class="cn">NA</span></span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>z.TV.est3 <span class="ot">&lt;-</span> z <span class="sc">*</span> <span class="cn">NA</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We make the training values of <span class="math inline">\(z_t\)</span> available to the forecasting equation.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>z.TV.est[<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(z.TR)] <span class="ot">&lt;-</span> z.TR</span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>z.TV.est2[<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(z.TR)] <span class="ot">&lt;-</span> z.TR</span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a>z.TV.est3[<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(z.TR)] <span class="ot">&lt;-</span> z.TR</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Similarly, we prepare two versions of <span class="math inline">\(\epsilon_t\)</span> containing the training residuals, to be used by the second and third procedure. Even though they look initially the same, these error terms are updated differently: the second procedure really updates them with a forecast equation, whereas the third one leaves the test error values as 0.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>w2 <span class="ot">&lt;-</span> z <span class="sc">*</span> <span class="dv">0</span></span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>w2[<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(z.TR)] <span class="ot">&lt;-</span> <span class="fu">residuals</span>(arima.fit)</span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a>w3 <span class="ot">&lt;-</span> z <span class="sc">*</span> <span class="dv">0</span></span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a>w3[<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(z.TR)] <span class="ot">&lt;-</span> <span class="fu">residuals</span>(arima.fit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We store the coefficients of the model (<code>_s</code> indicates seasonal)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>Phi_s <span class="ot">&lt;-</span> <span class="fu">coefficients</span>(arima.fit)[<span class="st">"sar1"</span>]</span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a>theta <span class="ot">&lt;-</span> <span class="fu">coefficients</span>(arima.fit)[<span class="st">"ma1"</span>]</span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a>Theta_s <span class="ot">&lt;-</span> <span class="fu">coefficients</span>(arima.fit)[<span class="st">"sma1"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And now we get the forecasts in a loop.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq</span>(<span class="fu">length</span>(z.TR) <span class="sc">+</span> <span class="dv">1</span>, <span class="fu">length</span>(y), <span class="dv">1</span>)){<span class="co"># loop for validation period</span></span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># The first one is simply what we did in the validation loop above</span></span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a>  z.TV.est[i] <span class="ot">&lt;-</span> forecast<span class="sc">::</span><span class="fu">forecast</span>(<span class="fu">subset</span>(z, <span class="at">end=</span>i<span class="dv">-1</span>), </span>
<span id="cb80-5"><a href="#cb80-5" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">model =</span> arima.fit,  </span>
<span id="cb80-6"><a href="#cb80-6" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">h=</span><span class="dv">1</span>)<span class="sc">$</span>mean           </span>
<span id="cb80-7"><a href="#cb80-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># In the second forecast procedure we use the two forecasting equations, with </span></span>
<span id="cb80-8"><a href="#cb80-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># real values of z and updating the errors with the second equation. </span></span>
<span id="cb80-9"><a href="#cb80-9" aria-hidden="true" tabindex="-1"></a>  z.TV.est2[i] <span class="ot">&lt;-</span> z[i <span class="sc">-</span> <span class="dv">1</span>] <span class="sc">+</span> z[i <span class="sc">-</span> <span class="dv">12</span>] <span class="sc">-</span> z[i<span class="dv">-13</span>] <span class="sc">+</span> </span>
<span id="cb80-10"><a href="#cb80-10" aria-hidden="true" tabindex="-1"></a>    Phi_s <span class="sc">*</span> (z[i<span class="dv">-12</span>] <span class="sc">-</span> z[i<span class="dv">-13</span>] <span class="sc">-</span> z[i <span class="sc">-</span> <span class="dv">24</span>] <span class="sc">+</span> z[i<span class="dv">-25</span>]) <span class="sc">+</span> </span>
<span id="cb80-11"><a href="#cb80-11" aria-hidden="true" tabindex="-1"></a>    w2[i] <span class="sc">+</span> theta <span class="sc">*</span> w2[i <span class="sc">-</span> <span class="dv">1</span>] <span class="sc">+</span>  Theta_s <span class="sc">*</span> w2[i <span class="sc">-</span> <span class="dv">12</span>] <span class="sc">+</span> theta <span class="sc">*</span> Theta_s <span class="sc">*</span> w2[i <span class="sc">-</span> <span class="dv">13</span>]</span>
<span id="cb80-12"><a href="#cb80-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb80-13"><a href="#cb80-13" aria-hidden="true" tabindex="-1"></a>  w2[i] <span class="ot">=</span> z[i] <span class="sc">-</span> z[i<span class="dv">-1</span>] <span class="sc">-</span> z[i<span class="dv">-12</span>] <span class="sc">+</span> z[i<span class="dv">-13</span>] <span class="sc">-</span></span>
<span id="cb80-14"><a href="#cb80-14" aria-hidden="true" tabindex="-1"></a>    Phi_s <span class="sc">*</span> (z[i<span class="dv">-12</span>] <span class="sc">-</span> z[i<span class="dv">-13</span>] <span class="sc">-</span> z[i<span class="dv">-24</span>] <span class="sc">+</span> z[i<span class="dv">-25</span>]) <span class="sc">-</span> </span>
<span id="cb80-15"><a href="#cb80-15" aria-hidden="true" tabindex="-1"></a>    theta <span class="sc">*</span> w2[i<span class="dv">-1</span>] <span class="sc">-</span> Theta_s <span class="sc">*</span> w2[i<span class="dv">-12</span>] <span class="sc">-</span> theta <span class="sc">*</span> Theta_s <span class="sc">*</span> w2[i<span class="dv">-13</span>]</span>
<span id="cb80-16"><a href="#cb80-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb80-17"><a href="#cb80-17" aria-hidden="true" tabindex="-1"></a>  <span class="co"># And in the third one we update the forecasted values z.TV.est3 using their </span></span>
<span id="cb80-18"><a href="#cb80-18" aria-hidden="true" tabindex="-1"></a>  <span class="co"># previous values and we do not update the error terms (they stay 0)</span></span>
<span id="cb80-19"><a href="#cb80-19" aria-hidden="true" tabindex="-1"></a>  z.TV.est3[i] <span class="ot">&lt;-</span> z.TV.est3[i <span class="sc">-</span> <span class="dv">1</span>] <span class="sc">+</span> z.TV.est3[i <span class="sc">-</span> <span class="dv">12</span>] <span class="sc">-</span> z.TV.est3[i<span class="dv">-13</span>] <span class="sc">+</span> </span>
<span id="cb80-20"><a href="#cb80-20" aria-hidden="true" tabindex="-1"></a>    Phi_s <span class="sc">*</span> (z.TV.est3[i<span class="dv">-12</span>] <span class="sc">-</span> z.TV.est3[i<span class="dv">-13</span>] <span class="sc">-</span> z.TV.est3[i <span class="sc">-</span> <span class="dv">24</span>] <span class="sc">+</span> z.TV.est3[i<span class="dv">-25</span>]) <span class="sc">+</span> </span>
<span id="cb80-21"><a href="#cb80-21" aria-hidden="true" tabindex="-1"></a>    w3[i] <span class="sc">+</span> theta <span class="sc">*</span> w3[i <span class="sc">-</span> <span class="dv">1</span>] <span class="sc">+</span>  Theta_s <span class="sc">*</span> w3[i <span class="sc">-</span> <span class="dv">12</span>] <span class="sc">+</span> theta <span class="sc">*</span> Theta_s <span class="sc">*</span> w3[i <span class="sc">-</span> <span class="dv">13</span>]</span>
<span id="cb80-22"><a href="#cb80-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-23"><a href="#cb80-23" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let us examine the results, comparing the first values for all the forecast procedures:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>k <span class="ot">&lt;-</span> <span class="dv">10</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Using forecast function directly (we called this s_est above):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(z_est<span class="sc">$</span>mean, k)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          Jan      Feb      Mar      Apr      May      Jun      Jul      Aug
1995 4.099109 4.179055 4.388351 4.294830 4.369889 4.398921 4.499703 4.063269
          Sep      Oct
1995 4.066478 4.261535</code></pre>
</div>
</div>
<p>Using the validation loop as explained in today’s session</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="fu">subset</span>(z.TV.est, <span class="at">start =</span> <span class="fu">length</span>(z.TR) <span class="sc">+</span> <span class="dv">1</span>, <span class="at">end =</span> <span class="fu">length</span>(z.TR) <span class="sc">+</span> k)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          Jan      Feb      Mar      Apr      May      Jun      Jul      Aug
1995 4.099109 4.070260 4.258979 4.200732 4.243077 4.260375 4.427713 3.877607
          Sep      Oct
1995 3.853199 4.023954</code></pre>
</div>
</div>
<p>Using the two forecast equations with actual z values and error updates</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="fu">subset</span>(z.TV.est2, <span class="at">start =</span> <span class="fu">length</span>(z.TR) <span class="sc">+</span> <span class="dv">1</span>, <span class="at">end =</span> <span class="fu">length</span>(z.TR) <span class="sc">+</span> k)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          Jan      Feb      Mar      Apr      May      Jun      Jul      Aug
1995 4.099130 4.070274 4.258966 4.200749 4.243050 4.260350 4.427711 3.877596
          Sep      Oct
1995 3.853198 4.023978</code></pre>
</div>
</div>
<p>Using only the forecasting equation for y and no error update</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="fu">subset</span>(z.TV.est3, <span class="at">start =</span> <span class="fu">length</span>(z.TR) <span class="sc">+</span> <span class="dv">1</span>, <span class="at">end =</span> <span class="fu">length</span>(z.TR) <span class="sc">+</span> k)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          Jan      Feb      Mar      Apr      May      Jun      Jul      Aug
1995 4.099130 4.179070 4.388345 4.294849 4.369871 4.398893 4.499688 4.063245
          Sep      Oct
1995 4.066459 4.261540</code></pre>
</div>
</div>
<p>The results indicate that, up to small rounding errors there are only two different results:</p>
<ul>
<li>the validation loop is doing what we called the second procedure.</li>
<li>the <code>forecast</code> function is doing what twe called the third procedure.</li>
</ul>
<p>The updated error values and the use of actual values of the time series explain why the validation loop produces more accurate values. This is illustrated in the plot below:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(<span class="fu">subset</span>(z, <span class="at">start =</span> <span class="fu">length</span>(z.TR) <span class="sc">-</span> <span class="dv">30</span>), <span class="at">series=</span><span class="st">"Real"</span>) <span class="sc">+</span></span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a>  forecast<span class="sc">::</span><span class="fu">autolayer</span>(<span class="fu">subset</span>(z.TV.est, <span class="at">start =</span> <span class="fu">length</span>(z.TR)), <span class="at">series=</span><span class="st">"Forecasting Loop"</span>) <span class="sc">+</span></span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a>  forecast<span class="sc">::</span><span class="fu">autolayer</span>(<span class="fu">subset</span>(z.TV.est3, <span class="at">start =</span> <span class="fu">length</span>(z.TR)), <span class="at">series=</span><span class="st">"Forecast function"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="2025_10_01_SARIMA_files/figure-html/unnamed-chunk-66-1.png" class="img-fluid figure-img" width="1152"></p>
</figure>
</div>
</div>
</div>
<p>Now we can also compare both approaches through their validation errors.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="fu">accuracy</span>(z_est, z)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                       ME      RMSE        MAE        MPE     MAPE      MASE
Training set -0.008851714 0.1130747 0.08373548 -0.3647752 2.684318 0.5294322
Test set     -0.082613248 0.1493240 0.12528694 -2.0788375 2.996520 0.7921486
                   ACF1 Theil's U
Training set 0.02378263        NA
Test set     0.56407002 0.6401048</code></pre>
</div>
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="fu">accuracy</span>(z.TV.est, z)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                   ME     RMSE        MAE         MPE      MAPE       ACF1
Test set 0.0004523454 0.030467 0.00842029 0.003263153 0.1975652 -0.1771778
         Theil's U
Test set 0.1090504</code></pre>
</div>
</div>
<p>As expected, direct use of the <code>forecast</code> function leads to worse predictive performance in the test set.</p>
</section>
<section id="references" class="level2 unnumbered">


</section>
</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" data-line-spacing="2" role="list">
<div id="ref-hyndman2018fpp2" class="csl-entry" role="listitem">
Hyndman, R. J., &amp; Athanasopoulos, G. (2018). <em>Forecasting: Principles and practice, 2nd edition</em>. OTexts. Retrieved from <a href="https://otexts.com/fpp2/">https://otexts.com/fpp2/</a>
</div>
<div id="ref-hyndman2021fpp3" class="csl-entry" role="listitem">
Hyndman, R. J., &amp; Athanasopoulos, G. (2021). <em>Forecasting: Principles and practice, 3rd edition</em>. OTexts. Retrieved from <a href="https://otexts.com/fpp3/">https://otexts.com/fpp3/</a>
</div>
<div id="ref-Krispin2019" class="csl-entry" role="listitem">
Krispin, R. (2019). <em>Hands-on time series analysis with r: Perform time series analysis and forecasting using r</em>. Packt Publishing Ltd. Retrieved from <a href="https://github.com/PacktPublishing/Hands-On-Time-Series-Analysis-with-R">https://github.com/PacktPublishing/Hands-On-Time-Series-Analysis-with-R</a>
</div>
</div></section></div></main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>